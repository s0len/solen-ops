# Node: control-2
# IP: 192.168.10.42
# Hardware: Intel 13400, Intel A310 GPU, 2.5G NIC, 64GB RAM, Samsung 870 EVO SATA SSD
---
machine:
  type: controlplane
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      permissions: 0o644
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
        [plugins."io.containerd.cri.v1.runtime"]
          cdi_spec_dirs = ["/var/cdi/static", "/var/cdi/dynamic"]
          device_ownership_from_security_context = true
  network:
    hostname: control-2
    interfaces:
      - deviceSelector:
          hardwareAddr: 78:20:51:38:a8:5d
        mtu: 1500
        dhcp: true
        vip:
          ip: 192.168.10.80
  install:
    diskSelector:
      model: "*SSD 870*"
    image: "factory.talos.dev/metal-installer/${TALOS_SCHEMATIC}:${TALOS_VERSION}"
    wipe: true # Clean install on new hardware
  sysfs:
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: 1
  sysctls:
    vm.nr_hugepages: "1024"
  udev:
    rules:
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    plex.node/preferred: "true"
    topology.kubernetes.io/zone: zone-c
    node.kubernetes.io/storage: ceph
