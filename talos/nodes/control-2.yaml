# Node: control-2
# IP: 192.168.10.42
# Hardware: Intel 10th gen, Intel GPU, NVMe storage
---
machine:
  type: controlplane
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      permissions: 0o644
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
        [plugins."io.containerd.cri.v1.runtime"]
          cdi_spec_dirs = ["/var/cdi/static", "/var/cdi/dynamic"]
          device_ownership_from_security_context = true
  network:
    hostname: control-2
    interfaces:
      - deviceSelector:
          hardwareAddr: 90:8d:6e:8a:d3:86
        mtu: 1500
        dhcp: true
        vip:
          ip: 192.168.10.80
  install:
    diskSelector:
      model: "*CT1000P3*"
    image: "factory.talos.dev/metal-installer/${TALOS_SCHEMATIC}:${TALOS_VERSION}"
    wipe: false
  sysfs:
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: 1
  sysctls:
    vm.nr_hugepages: "1024"
  udev:
    rules:
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
    topology.kubernetes.io/zone: zone-c
    node-role.kubernetes.io/low-memory: "true"
